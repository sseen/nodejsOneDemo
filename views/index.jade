extends layout

block content
  script(src='javascripts/http.js')
  script.
      mui.init({
          pullRefresh: {
              container: '#pullrefresh',
              down: {
                  callback: pulldownRefresh
              },
              up: {
                  contentrefresh: '正在加载...',
                  callback: pullupRefresh
              }
          }
      });
      var count = 1;
      /**
       * 下拉刷新具体业务实现
       */
      function pulldownRefresh() {
          getUrlContent()
          count = 1;
      }

      /**
       * 上拉加载具体业务实现
       */
      function pullupRefresh() {
          setTimeout(function () {
              mui('#pullrefresh').pullRefresh().endPullupToRefresh((++count > 400)); //参数为true代表没有更多数据了。
              getMoreDat(count);
          },800);

      }

      //主列表点击事件
      mui('#uList').on('tap', 'a', function () {
          var id = this.getAttribute("data-wid");
          if (!id) {
              id = this.getAttribute('href');
          }
          var href = this.getAttribute('href');

          mui.openWindow({
              url:'http://127.0.0.1:3000/routeToDetail',
              id:href,
              extras:{
                  urlStr:href
              }
          })

          //alert(href);
          //非plus环境，直接走href跳转
          //if (!mui.os.plus) {
          //    location.href = href;
          //    return;
          //}
      });



  div#header
    h1= title
    p Welcome to #{title}
    a(href='/users') Users
    button(onclick=('getUrlContent()')) Click

  div#pullrefresh
    div#scroll
      div#topFresh
        ul#uList
